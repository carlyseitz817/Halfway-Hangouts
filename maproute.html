<html>
  <head>
  <meta name="viewport" content="initial-scale=1.0, width=device-width" />

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="http://js.api.here.com/v3/3.0/mapsjs-core.js"
  type="text/javascript" charset="utf-8"></script>
  <script src="http://js.api.here.com/v3/3.0/mapsjs-service.js"
  type="text/javascript" charset="utf-8"></script>
  <script src="http://js.api.here.com/v3/3.0/mapsjs-mapevents.js" 
     type="text/javascript" charset="utf-8"></script>
  <script src="http://js.api.here.com/v3/3.0/mapsjs-ui.js" 
      type="text/javascript" charset="utf-8"></script>
  <link rel="stylesheet" type="text/css" href="http://js.api.here.com/v3/3.0/mapsjs-ui.css" />
  </head>
  <body>


  <div id="mapContainer"></div>

  <input id="address1"><button id="findme1">FIND ME</button>
  <input id="address2"><button id="findme2">FIND ME</button>

  <button id="route">Route It</button>

  <script>

    var address = '';

    var geocode1 = [];
    var geocode2 = [];
  
    

    //---------------------------------------------------//
    //------------------Initialize Map-------------------//
    //---------------------------------------------------//



    // Initialize the platform object:
    var platform = new H.service.Platform({
        'app_id': 'qXr6JxTSNIjGC5Oz6R2u',
    'app_code': 'dYXcTWDO6R-CHChaYaULZA'
    });

    //needed for the geocoding
    var targetElement = document.getElementById('mapContainer');

    // Obtain the default map types from the platform object
    var defaultLayers = platform.createDefaultLayers();

    // Instantiate (and display) a map object:
    var map = new H.Map(
        document.getElementById('mapContainer'),
    defaultLayers.normal.map,
    {
        zoom: 10,
      center: { lat: 30.27, lng: -97.74 }
    });

    // Create the default UI:
    var ui = H.ui.UI.createDefault(map, defaultLayers);



    //------------------------------------------------------------------//
    //------------------Gecoding - Grabbing an Address------------------//
    //------------------------------------------------------------------//



    //------------------Address1 --> 1st Geocode Set--------------------//

    $("#findme1").on('click', function (){
        address = $("#address1").val().trim();


    console.log(address);

    // Create the parameters for the geocoding request:
    var geocodingParams = {
      searchText: address
    };
    

    // Define a callback function to process the geocoding response:
    var onResult = function(result) {
        var locations = result.Response.View[0].Result,
      position,
      marker;
    // Add a marker for each location found
    for (i = 0;  i < locations.length; i++) {
        position = {
            lat: locations[i].Location.DisplayPosition.Latitude,
            lng: locations[i].Location.DisplayPosition.Longitude
        };
            console.log(position.lat, position.lng);
            geocode1.push(position.lat, position.lng);

    marker = new H.map.Marker(position);
    map.addObject(marker);
    }
    };

    // Get an instance of the geocoding service:
    var geocoder = platform.getGeocodingService();

    // Call the geocode method with the geocoding parameters,
    // the callback and an error callback function (called if a
    // communication error occurs):
    geocoder.geocode(geocodingParams, onResult, function(e) {
      alert(e);

    });

    });


    //----------------------Address2 --> 2nd Geocode Set----------------------//


    $("#findme2").on('click', function(){
        address = $("#address2").val().trim();

        console.log(address);

    // Create the parameters for the geocoding request:
    var geocodingParams = {
      searchText: address
    };
    

    // Define a callback function to process the geocoding response:
    var onResult = function(result) {
        var locations = result.Response.View[0].Result,
      position,
      marker;
    // Add a marker for each location found
    for (i = 0;  i < locations.length; i++) {
        position = {
            lat: locations[i].Location.DisplayPosition.Latitude,
            lng: locations[i].Location.DisplayPosition.Longitude
        };
            console.log(position.lat, position.lng);
            geocode2.push(position.lat, position.lng);

    marker = new H.map.Marker(position);
    map.addObject(marker);
    }
    };

    // Get an instance of the geocoding service:
    var geocoder = platform.getGeocodingService();

    // Call the geocode method with the geocoding parameters,
    // the callback and an error callback function (called if a
    // communication error occurs):
    geocoder.geocode(geocodingParams, onResult, function(e) {
      alert(e);

    });

    });

    

    //----------------------Routing Functionality----------------------//

$("#route").on('click', function(){

    geocode1 = geocode1.map(String);
    console.log(geocode1);

    var waypoint0 = 'geo!' + geocode1[0] + ',' + geocode1[1];
    console.log(waypoint0);

    geocode2 = geocode2.map(String);

    var waypoint1 = 'geo!' + geocode2[0] + ',' + geocode2[1];

    
    // Create the parameters for the routing request:
var routingParameters = {
    // The routing mode:
  'mode': 'fastest;car',
  // The start point of the route:
  'waypoint0': waypoint0,
  // The end point of the route:
  'waypoint1': waypoint1,
  // To retrieve the shape of the route we choose the route
  // representation mode 'display'
  'representation': 'display'
};

// Define a callback function to process the routing response:
var onResult = function(result) {
    var route,
    routeShape,
    startPoint,
    endPoint,
    linestring;
  if(result.response.route) {
      // Pick the first route from the response:
  route = result.response.route[0];
  // Pick the route's shape:
  routeShape = route.shape;

  // Create a linestring to use as a point source for the route line
  linestring = new H.geo.LineString();

  // Push all the points in the shape into the linestring:
  routeShape.forEach(function(point) {
      var parts = point.split(',');
    linestring.pushLatLngAlt(parts[0], parts[1]);
  });

  // Retrieve the mapped positions of the requested waypoints:
  startPoint = route.waypoint[0].mappedPosition;
  endPoint = route.waypoint[1].mappedPosition;

  // Create a polyline to display the route:
  var routeLine = new H.map.Polyline(linestring, {
      style: { strokeColor: 'blue', lineWidth: 10 }
  });

  // Create a marker for the start point:
  var startMarker = new H.map.Marker({
      lat: startPoint.latitude,
    lng: startPoint.longitude
  });

  // Create a marker for the end point:
  var endMarker = new H.map.Marker({
      lat: endPoint.latitude,
    lng: endPoint.longitude
  });

  // Add the route polyline and the two markers to the map:
  map.addObjects([routeLine, startMarker, endMarker]);

  // Set the map's viewport to make the whole route visible:
  map.setViewBounds(routeLine.getBounds());
  }
};

// Get an instance of the routing service:
var router = platform.getRoutingService();

// Call calculateRoute() with the routing parameters,
// the callback and an error callback function (called if a
// communication error occurs):
router.calculateRoute(routingParameters, onResult,
  function(error) {
      alert(error.message);
  });

});

  </script>
  </body>
</html>